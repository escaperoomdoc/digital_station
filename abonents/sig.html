<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Sig</title>
    <link rel="stylesheet" href="sig/css/main.css">
    <script src="sig/js/vue.js"></script>
</head>
<body>
    <header>
        <div>
            <div>Станция «Цифровая»</div>
            <div>00:00:00</div>
        </div>
        <div>
            <div>СТЦ</div>
            <div>Иванова И. И.</div>
        </div>
    </header>
    <main>
        <ul>
            <li class="list list_header">
                <div>Путь</div>
                <div>Состав</div>
                <div>Статус</div>
            </li>
            <div v-for = "(way, i) in ways">
            <li class="list" @click="changeWay(i)" :class="['list_'+ways[i].status, {'list_active': ways[i].active}]">
                <div>{{ ways[i].way }}</div>
                <div>{{ ways[i].stock }}</div>
                <div></div>
            </li>
                <transition name="submenu">
                <div v-if="i == selectedWay" style="overflow: hidden">
                    <p>Подтвердите действие</p>
                    <div class="buttons" v-if="ways[i].active">
                        <button class="confirm" @click="confirm">OK</button>
                        <button class="cancel" @click="cancel">Cancel</button>
                    </div>
                    <div class="buttons" v-if="!ways[i].active">
                        <button class="confirm fake">OK</button>
                        <button class="cancel fake">Cancel</button>
                    </div>

                </div>
                </transition>
            </div>
        </ul>

    </main>
    <script src="sig/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.dev.js"></script>
    <script>
        var socket = io.connect(location.host);
        socket.on('server2client', function(data) {
            try {
                var obj = JSON.parse(data);
                console.log(obj);
                updateSigList(obj);
            }
            catch(error) {
                console.log('ERROR : ' + error + ' # ' + data);
            }
        });
        setTimeout(() => {
            socket.emit('client2server', '{"command":"subscribe","name":"sig","getmodel":"true"}');
        }, 1000);
        setInterval(() => {
            socket.emit('client2server', '{"command":"dummy","getmodel":"true"}');
        }, 1000);
    </script>
</body>
</html>